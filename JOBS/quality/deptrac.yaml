-   name: deptrac
    hosts: localhost
    remote_user: ans
    vars:
      -   work_dir: "/tmp"
      -   build_tag: "build-sphere-backend-{{ CI_COMMIT_SHORT_SHA }}"

    tasks:
      -   name: Определяем последнюю тестовую сборку
          raw: ls -d -r {{ work_dir }}/{{ build_tag }}_* | head -n  1
          register: build_dir_result

      -   name: Директория для проверок
          debug: var=build_dir_result.stdout_lines

      -   raw: cd "{{ build_dir_result.stdout_lines[0] }}/app" \
              vendor/bin/deptrac --config-file=deptrac.modules.yaml --cache-file=var/.deptrac.modules.cache 
              vendor/bin/deptrac --config-file=deptrac.yaml --cache-file=var/.deptrac.cache
          register: deptrac_result

      -   name: "Вывод:"
          debug: var=deptrac_result.stdout_lines
